services:
  tcp-server:
    build:
      context: .
      dockerfile: server.Dockerfile
    environment:
      BROKER_HOST: mqtt-server
      BROKER_USER: connection
      BROKER_PASSWORD: "<set mqtt password>"
      CRYPTO_KEY: "<key for cipher>"
      WORKERS: 2
      CLIENTS: example
      SERVER_TCP_TARGET: "http:squid-server:3128;iperf-tcp:0.0.0.0:9091"
      SERVER_UDP_TARGET: "iperf-udp:0.0.0.0:9092;dns:8.8.8.8:53"
      STAT_FILE: stat.json
    restart: unless-stopped

  squid-server:
    image: ubuntu/squid
    restart: unless-stopped

  mqtt-server:
    build:
      context: .
      dockerfile: mosquitto.Dockerfile
    ports:
      - "1883:1883/tcp"
    volumes:
      - ".mqtt_pass:/mosquitto/config/host/"
